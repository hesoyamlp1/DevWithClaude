---
name: database-migration
description: 数据库迁移技能。在创建表、修改表结构、编写迁移脚本时自动调用。强调版本控制和不可变原则。
---

# 数据库迁移技能

## 项目配置

<!-- BEGIN:DATABASE -->
**数据库信息:**

- 类型: 待填充
- 位置: 待填充
<!-- END:DATABASE -->

<!-- BEGIN:MIGRATION -->
**迁移工具:**

- 工具: 待填充
- 脚本位置: 待填充
- 命名规则: 待填充
<!-- END:MIGRATION -->

---

## 开发流程

```
1. 查阅项目配置 → 2. 查看现有表结构 → 3. 创建迁移脚本 → 4. 记录产出
```

### 1. 查阅项目配置

阅读上方「项目配置」章节，了解数据库类型和迁移工具。

### 2. 查看现有表结构

```bash
# 搜索已记录的 models
project search <关键词>

# 查看现有迁移脚本
Glob: "**/migration/**/*.sql"
Glob: "**/db/**/*.sql"

# 阅读表结构
Read: 相关迁移脚本
```

### 3. 创建迁移脚本

- 按照项目的命名规则创建新脚本
- 版本号递增
- 遵循项目现有的 SQL 风格

### 4. 记录产出

```bash
task done T001 '{
  "summary": "做了什么",
  "models": ["表名: 字段说明"]
}'
```

---

## 通用原则

### 版本控制

| 原则 | 说明 |
|-----|------|
| 版本递增 | 新变更创建新版本，不修改旧版本 |
| 不可变 | **永远不要修改已执行的迁移脚本** |
| 可回滚 | 考虑如何回滚变更 |

### SQL 规范

- 表名、字段名使用 snake_case
- 主键字段命名为 `id`
- 时间字段：`created_at`, `updated_at`
- 添加必要的索引
- 添加外键约束（如果适用）

### 安全原则

- 不要在迁移脚本中硬编码敏感数据
- 大表变更考虑锁表影响
- 删除操作要谨慎

---

## 禁止事项

- **永远不要修改已执行的迁移脚本**
- 不要跳过查看现有表结构
- 不要假设数据库类型
- 不要在 Java/TS 代码中硬编码 SQL
- 不要直接操作生产数据库
