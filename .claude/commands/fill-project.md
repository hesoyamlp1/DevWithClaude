# 填充项目资产

根据架构文档探索代码库，详细填充 project.json 中的所有资产信息。

**使用方式**: `/fill-project <架构文档路径>`

**示例**: `/fill-project .claude-old/specs/game-architecture.md`

**特性**:
- 支持重复运行，每次运行会补充和完善已有内容
- 已存在的条目会被更新，新条目会被添加

---

## 执行流程

```
1. 读取架构文档 → 2. 分析探索计划 → 3. 并行探索 → 4. 增量填充 → 5. 检查效果
```

---

## 阶段 1：读取架构文档

读取用户指定的架构文档，理解：

- 整体架构设计（层级、模块划分）
- 各模块的职责和依赖关系
- 数据模型设计
- API 设计
- 核心能力/工具

如果用户未提供路径，使用 AskUserQuestion 询问。

---

## 阶段 2：分析探索计划

基于架构文档内容，**自主决定**需要探索的维度和并发数量。

考虑因素：
- 架构文档涉及多少个独立模块？
- 是否有前端/后端/数据库多层？
- 模块之间是否有依赖关系？

输出探索计划：

```
## 探索计划

基于架构文档，我将启动 X 个并行探索任务：

1. [任务名称] - 探索目标描述
2. [任务名称] - 探索目标描述
...

确认后开始执行。
```

---

## 阶段 3：并行探索

根据探索计划，启动多个 Explore subagent 并行探索。

**每个探索任务的通用要求：**

- 返回结构化 JSON 结果
- 包含文件路径信息（用于 index 字段）
- 标注实现状态（done/partial/in_progress/planned）

**探索内容参考（根据实际情况选择）：**

- 架构层级和核心组件
- 各业务模块的实现状态和入口文件
- 数据模型和表结构
- REST API 接口
- 后端工具/服务方法
- 前端组件和页面
- 能力层模块（LLM、公式引擎等）

---

## 阶段 4：增量填充

收集探索结果后，**增量更新** project.json：

### 填充规则

| 情况 | 处理方式 |
|------|----------|
| 新条目 | 直接添加 |
| 已存在条目 | 使用 update 命令更新 |
| 已存在但信息更完整 | 合并补充 |

### 填充命令

```bash
# 层级定义
project arch layers '<json>'

# 模块（先检查是否存在）
project arch add '<json>'      # 新模块
project arch update '<json>'   # 已存在

# 资产（add 会自动覆盖同名条目）
project add model '<json>'
project add api '<json>'
project add util '<json>'
project add component '<json>'
```

---

## 阶段 5：检查效果

执行检查命令并输出报告：

```bash
project info
project arch
project list all
```

**输出格式：**

```
## 填充报告

### 本次更新
- 新增模块: X 个
- 更新模块: X 个
- 新增资产: models +X, apis +X, utils +X, components +X

### 当前状态
[project info 输出]

### 架构模块
[project arch 输出]

### 待完善
- [如有遗漏或需要补充的内容列在这里]

### 下一步
- 再次运行 `/fill-project` 可继续完善
- 手动调整: `project arch update '<json>'`
```

---

## 重复运行说明

此命令设计为可重复运行：

1. **首次运行**: 建立基础结构，填充主要内容
2. **后续运行**: 补充遗漏、更新状态、细化描述

每次运行时，会：
- 读取当前 project.json 状态
- 与新探索结果对比
- 只更新有变化或新增的内容

---

## 注意事项

- 状态判断标准：
  - **done**: 核心功能已实现，有完整接口和测试
  - **partial**: 部分功能已实现
  - **in_progress**: 有代码框架但功能不完整
  - **planned**: 架构文档中有但代码中未实现
- index 字段应使用相对于项目根目录的路径
- 探索结果基于代码实际情况，可能与架构文档有差异
